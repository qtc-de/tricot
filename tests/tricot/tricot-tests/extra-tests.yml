tester:
  name: extra
  title: Extra Tests
  description: |-
    'Perfors some additional tests on tricot, not related to plugins
    or validators.'

  id: 04
  groups:
    - extra

tests:
  - title: Docker
    description: |-
      'Test tricots docker integration'

    command:
      - tricot
      - ${EXTRA}/Docker.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
            - 'Starting container: nginx-host'
            - 'Stopping container: nginx-host'
            - 'Starting container: nginx'
            - 'Stopping container: nginx'
            - 'Network Mode: host'
            - 'Network Mode: default'
          counts:
            - 3
            - 0
            - 1
            - 1
            - 2
            - 2
            - 1
            - 1
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Env
    description: |-
      'Test tricots environment integration'

    command:
      - tricot
      - ${EXTRA}/Env.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
          counts:
            - 9
            - 0
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Conditions - Regular
    description: |-
      "Test tricot's condition feature"

    command:
      - tricot
      - ${EXTRA}/Conditionals/Regular/launcher.yml

    validators:
      - status: 12
      - count:
          values:
            - Success... success
            - Failure... failed
            - Skipped... skipped
            - 'Skipping test: Conditionals Skipped'
          counts:
            - 11
            - 1
            - 10
            - 2
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Conditions - Error1
    description: |-
      "Test tricot's condition feature"

    command:
      - tricot
      - ${EXTRA}/Conditionals/Error1/launcher.yml

    validators:
      - status: 16
      - contains:
          values:
            - "Condition 'Test5' was used but never declared within a tester"


  - title: Conditions - Error2
    description: |-
      "Test tricot's condition feature"

    command:
      - tricot
      - ${EXTRA}/Conditionals/Error2/launcher.yml

    validators:
      - status: 16
      - contains:
          values:
            - "Condition 'Test5' was used but never declared within a tester"


  - title: Conditions - Error3
    description: |-
      "Test tricot's condition feature"

    command:
      - tricot
      - ${EXTRA}/Conditionals/Error3/launcher.yml

    validators:
      - status: 16
      - contains:
          values:
            - "Conditions need to be specified as string -> bool pairs"


  - title: Conditions - Error4
    description: |-
      "Test tricot's condition feature"

    command:
      - tricot
      - ${EXTRA}/Conditionals/Error4/launcher.yml

    validators:
      - status: 16
      - contains:
          values:
            - "The keys 'all', 'one_of' and 'none_of' need to be lists"


  - title: Variables
    description: |-
      "Different test on tricot variables"

    command:
      - tricot
      - --variables
      - r_var1="named runtime variable"
      - r_var2="another named runtime variable"
      - --positionals
      - "positional runtime variable"
      - "another positional runtime variable"
      - '--'
      - ${EXTRA}/Variables.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
          counts:
            - 7
            - 0
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Streams
    description: |-
      "Different test on tricot streams"

    command:
      - tricot
      - ${EXTRA}/Streams.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
          counts:
            - 4
            - 0
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Prev
    description: |-
      "Test whether $prev variable works as expected"

    command:
      - tricot
      - ${EXTRA}/Prev.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
          counts:
            - 2
            - 0
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Shell
    description: |-
      "Test tricot command execution in shell mode"

    command:
      - tricot
      - ${EXTRA}/Shell.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
          counts:
            - 3
            - 0
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Log
    description: |-
      "Test tricot's logfile feature"

    command:
      - tricot
      - ${EXTRA}/Log.yml

    validators:
      - error: False
      - count:
          values:
            - Success... success
            - Fail... failed
          counts:
            - 2
            - 0
      - contains:
          invert:
            - Fail... success
            - Success... failed


  - title: Groups All
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml

    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Groups One
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - group_one
    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
          invert:
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Groups Two
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - group_two
    validators:
      - error: False
      - contains:
          values:
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success
          invert:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success


  - title: Groups One - One
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - group_one,one
    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
          invert:
            - Test Group One - Two... success
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Groups One / Two - One
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - '{group_one,group_two},one'
    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
            - Test Group Two - One... success
          invert:
            - Test Group One - Two... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Groups One / Two - One (explicit)
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - 'group_one,one'
      - 'group_two,one'
    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
            - Test Group Two - One... success
          invert:
            - Test Group One - Two... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Groups One / Two * - Two
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - '{group_one,group_two},*,two'
    validators:
      - error: False
      - contains:
          values:
            - Test Group Three - Two... success
            - Test Group Four - Two... success
          invert:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Four - One... success


  - title: Groups ** - One
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - '**,one'
    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
            - Test Group Two - One... success
            - Test Group Three - One... success
            - Test Group Four - One... success
          invert:
            - Test Group One - Two... success
            - Test Group Two - Two... success
            - Test Group Three - Two... success
            - Test Group Four - Two... success


  - title: Exclude group_one
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --exclude-groups
      - group_one

    validators:
      - error: False
      - contains:
          values:
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success
          invert:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success


  - title: Exclude ** - One
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --exclude-groups
      - '**,one'

    validators:
      - error: False
      - contains:
          values:
            - Test Group One - Two... success
            - Test Group Two - Two... success
            - Test Group Three - Two... success
            - Test Group Four - Two... success
          invert:
            - Test Group One - One... success
            - Test Group Two - One... success
            - Test Group Three - One... success
            - Test Group Four - One... success


  - title: Exclude vs Include
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --exclude-groups
      - 'group_one'
      - --groups
      - 'group_one'

    validators:
      - error: False
      - contains:
          invert:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Exclude vs Include 2
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --exclude-groups
      - 'group_one'
      - --groups
      - '**,one'

    validators:
      - error: False
      - contains:
          values:
            - Test Group Two - One... success
            - Test Group Four - One... success
          invert:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Two - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Four - Two... success


  - title: Exclude vs Include 3
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --exclude-groups
      - 'group_one,one'
      - --groups
      - 'group_one'

    validators:
      - error: False
      - contains:
          values:
            - Test Group One - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
          invert:
            - Test Group One - One... success
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Group Merge
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --groups
      - 'merge'

    validators:
      - error: False
      - contains:
          values:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success


  - title: Group Merge Exclude
    description: |-
      "Test tricot's test group feature"

    command:
      - tricot
      - ${EXTRA}/Groups.yml
      - --exclude-groups
      - 'group_one'
      - --groups
      - 'merge'

    validators:
      - error: False
      - contains:
          values:
            - Test Group Two - One... success
            - Test Group Two - Two... success
            - Test Group Four - One... success
            - Test Group Four - Two... success
          invert:
            - Test Group One - One... success
            - Test Group One - Two... success
            - Test Group Three - One... success
            - Test Group Three - Two... success
